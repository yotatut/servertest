<!DOCTYPE html>

<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¥å‡ºåº«ç™»éŒ²</title>


  <link rel="stylesheet" href="css/commonstylesheet.css">
  <link rel="stylesheet" href="css/nyusyukkostylesheet.css">

</head>

<body>


  <h2 class="heading">å…¥å‡ºåº«ç™»éŒ²</h2>
  <table id="myTable" class="registrationForm">

    <!-- æ—¥ä»˜ -->
    <tr>
      <td class="rounded-box-attribute">
        æ—¥ä»˜ã€€ã€€ã€€ã€€&gt;
      </td>
      <td id="nowDate" class="nowDate">
        <!-- <span id="nowDate" class="insertValue nowDate"></span> -->
        <!--<input type="date" id="nowDate">-->
      </td>
    </tr>

    <!-- å…¥å‡ºåº« -->
    <tr>
      <td class="rounded-box-attribute">
        åŒºåˆ†ã€€ã€€ã€€ã€€&gt;
      </td>
      <td>
        <span class="insertValue">
          <!-- ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ -->
          <form id="ioForm" class="rounded-box-field">
            <label class="molding">
              <input type="radio" name="io_flag" value="1" checked> å…¥åº«
            </label>

            <label class="molding">
              <input type="radio" name="io_flag" value="2">å‡ºåº«
            </label>
          </form>
        </span>
        <!--<script>
            // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãŒé¸æŠã•ã‚ŒãŸã¨ãã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹å ´åˆ
            var radioButtons = document.querySelectorAll('input[type="radio"]');
            
            radioButtons.forEach(function(radioButton) {
              radioButton.addEventListener('change', function() {
                console.log('é¸æŠã•ã‚ŒãŸå€¤:', this.value);
              });
            });
        </script> -->
      </td>
    </tr>

    <!-- Barcodeã¨å•†å“å -->
    <tr>
      <td id="rounded-box-main" class="rounded-box-attribute">
        Barcodeã€€&nbsp;<span class="text-right">&gt;</span>
        <a href="./barcodeScan.html" class="scanner">Go to Scan</a>
      </td>
      <td id="receivedBarcode" class="receivedBarcode"></td>
    </tr>

    <!-- æ•°é‡ -->
    <tr>
      <td class="rounded-box-attribute">
        æ•°é‡ã€€ã€€ã€€ã€€&gt;
      </td>
      <td>
        <span class="insertValue">
          <input type="text" class="amount" name="amount" placeholder="ã“ã“ã«æ•°é‡(åŠè§’)ã‚’å…¥åŠ›" required>
        </span>
      </td>
    </tr>
  </table>

  <button type="submit" class="insertButton button" onclick="tableToJsonThenSubmit()" >ğŸ–Šç™»éŒ²</button><!--mongo_insert()-->
  <!--<input type="hidden" name="delete_id" value="test">-->
  <script src="src/getCurrentDate.js"></script>
  <script src="src/getQueryParam.js"></script>
  <script src="src/getSelectedRadioButton.js"></script>
</body>

</html>

<!-- <button onclick="tableToJsonThenSubmit()">Convert to JSON</button> -->

<script>

  function tableToJsonThenSubmit() {
    const table = document.getElementById('myTable');
    const rows = table.getElementsByTagName('tr');
    const data = [];

    for (let i = 0; i < rows.length; i++) {
      const row = rows[i];
      const dataCells = row.querySelectorAll('.insertValue');//ãƒãƒªãƒ¥ãƒ¼
      const rowData = {};

      for (let j = 0; j < dataCells.length; j++) {
        const cell = dataCells[j];
        // console.log(cell);
        const input = cell.querySelector('input');
        // console.log("input",input);
        const spanName = cell.getAttribute('name');
        // console.log("span",spanName);
        const textContent = cell.textContent.trim();
        // console.log("text",textContent);

        //htmlè¦ç´ ã®å±æ€§ã§{name:value}ä½œæˆ
        if (input) {
          if (input.type=='radio') {
            rowData[input.name] = getSelectedRadioButton();
          } else {
            rowData[input.name] = input.value;
          }
          //rowData[input.name]=input.value?input.value:getSelectedRadioButton();
        } else if (spanName) {
          rowData[spanName] = textContent;
        } else {
          rowData[textContent.name] = textContent;
        }
      }

      data.push(rowData);
    }
    console.log(JSON.stringify(data, null, 2));

    fetch('/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
      .then(response => response.text())
      .then(msg => {
        //ä»Šå›ã®å ´åˆã€{message: 'Data received successfully!'}ãŒè¿”ã•ã‚Œã‚‹
          alert(msg);
        })
      .catch(error => console.error('Error:', error));

    // JSONæ–‡å­—åˆ—ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
    // console.log(jsonString);

  }

</script>

</body>

</html>